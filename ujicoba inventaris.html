<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventaris Lab TJKT SMKN 1 LIWA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        

        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .nav-btn.active {
            background-color: #374151;
            border-bottom: 3px solid #667eea;
        }
        
        .scrolling-text {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3, #54a0ff);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbow 3s ease-in-out infinite, scroll 15s linear infinite;
        }
        
        @keyframes rainbow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
        <div class="card rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">INVENTARIS LAB TJKT</h1>
                <p class="text-gray-600">SMKN 1 LIWA</p>
            </div>
            

            
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
                </div>
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-semibold">LOGIN</button>
            </form>
            
            <div class="text-center mt-6">
                <button id="showRegister" class="text-purple-600 hover:text-purple-800 font-medium">Belum punya akun? Daftar disini</button>
            </div>
        </div>
    </div>

    <!-- Register Page -->
    <div id="registerPage" class="min-h-screen flex items-center justify-center p-4 hidden">
        <div class="card rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">REGISTRASI</h1>
                <p class="text-gray-600">Buat Akun Baru</p>
            </div>
            
            <form id="registerForm" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Nama Lengkap</label>
                    <input type="text" id="regName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Username</label>
                    <input type="text" id="regUsername" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Password</label>
                    <input type="password" id="regPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Konfirmasi Password</label>
                    <input type="password" id="regConfirmPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
                </div>
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-semibold">DAFTAR</button>
            </form>
            
            <div class="text-center mt-6">
                <button id="showLogin" class="text-purple-600 hover:text-purple-800 font-medium">Sudah punya akun? Login disini</button>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Inventaris Lab TJKT</h1>
                        <p class="text-gray-600">SMKN 1 LIWA</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="currentUser" class="text-gray-700 font-medium"></span>
                        <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-gray-800 text-white">
            <div class="container mx-auto px-4">
                <div class="flex flex-wrap">
                    <button class="nav-btn px-4 py-3 hover:bg-gray-700 active" data-page="beranda">üè† Beranda</button>
                    <button class="nav-btn px-4 py-3 hover:bg-gray-700" data-page="input-barang">‚ûï Input Barang</button>
                    <button class="nav-btn px-4 py-3 hover:bg-gray-700" data-page="database-barang">üì¶ Database Barang</button>
                    <button class="nav-btn px-4 py-3 hover:bg-gray-700" data-page="peminjaman">üì§ Peminjaman</button>
                    <button class="nav-btn px-4 py-3 hover:bg-gray-700" data-page="pengembalian">üì• Pengembalian</button>
                    <button class="nav-btn px-4 py-3 hover:bg-gray-700" data-page="laporan">üìä Laporan</button>
                    <button class="nav-btn px-4 py-3 hover:bg-gray-700" data-page="hapus-barang">üóëÔ∏è Hapus Barang</button>
                    <button class="nav-btn px-4 py-3 hover:bg-gray-700" data-page="barang-rusak">‚ö†Ô∏è Barang Rusak</button>
                    <button class="nav-btn px-4 py-3 hover:bg-gray-700" data-page="edit-barang">‚úèÔ∏è Edit Barang</button>
                </div>
            </div>
        </nav>

        <!-- Content Area -->
        <main class="container mx-auto px-4 py-8">
            <!-- Beranda -->
            <div id="beranda" class="page-content">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-white mb-4">üéì SELAMAT DATANG üéì</h2>
                    <div class="overflow-hidden bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg p-4 shadow-lg">
                        <p class="scrolling-text text-2xl font-bold whitespace-nowrap">SISTEM INVENTARIS LABORATORIUM TJKT SMKN 1 LIWA</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="card rounded-xl p-6 text-center shadow-lg">
                        <div class="text-4xl mb-4">üì¶</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Total Barang</h3>
                        <p id="totalBarang" class="text-3xl font-bold text-blue-600">0</p>
                    </div>
                    <div class="card rounded-xl p-6 text-center shadow-lg">
                        <div class="text-4xl mb-4">üì§</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Dipinjam</h3>
                        <p id="totalDipinjam" class="text-3xl font-bold text-orange-600">0</p>
                    </div>
                    <div class="card rounded-xl p-6 text-center shadow-lg">
                        <div class="text-4xl mb-4">‚ö†Ô∏è</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Rusak</h3>
                        <p id="totalRusak" class="text-3xl font-bold text-red-600">0</p>
                    </div>
                    <div class="card rounded-xl p-6 text-center shadow-lg">
                        <div class="text-4xl mb-4">‚úÖ</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Tersedia</h3>
                        <p id="totalTersedia" class="text-3xl font-bold text-green-600">0</p>
                    </div>
                </div>
            </div>

            <!-- Input Barang -->
            <div id="input-barang" class="page-content hidden">
                <div class="card rounded-xl p-8 shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Input Data Barang</h2>
                    <form id="inputBarangForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Nama Barang</label>
                            <input type="text" id="namaBarang" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Kode Barang</label>
                            <input type="text" id="kodeBarang" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Seri Barang</label>
                            <input type="text" id="seriBarang" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Kondisi Barang</label>
                            <select id="kondisiBarang" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                                <option value="">Pilih Kondisi</option>
                                <option value="Baik">Baik</option>
                                <option value="Cukup">Cukup</option>
                                <option value="Rusak">Rusak</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Jumlah Barang</label>
                            <input type="number" id="jumlahBarang" min="1" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="btn-primary text-white px-8 py-3 rounded-lg font-semibold">Simpan Barang</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Database Barang -->
            <div id="database-barang" class="page-content hidden">
                <div class="card rounded-xl p-8 shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Database Barang</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="px-4 py-3 text-left border">Kode</th>
                                    <th class="px-4 py-3 text-left border">Nama Barang</th>
                                    <th class="px-4 py-3 text-left border">Seri</th>
                                    <th class="px-4 py-3 text-left border">Kondisi</th>
                                    <th class="px-4 py-3 text-left border">Jumlah</th>
                                    <th class="px-4 py-3 text-left border">Status</th>
                                </tr>
                            </thead>
                            <tbody id="databaseBarangTable">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Peminjaman -->
            <div id="peminjaman" class="page-content hidden">
                <div class="card rounded-xl p-8 shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Peminjaman Barang</h2>
                    <form id="peminjamanForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Nama Peminjam</label>
                            <input type="text" id="namaPeminjam" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Tanggal Peminjaman</label>
                            <input type="date" id="tanggalPeminjaman" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Pilih Barang</label>
                            <select id="pilihBarangPinjam" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                                <option value="">Pilih Barang</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Jumlah Peminjaman</label>
                            <input type="number" id="jumlahPeminjaman" min="1" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="btn-primary text-white px-8 py-3 rounded-lg font-semibold">Proses Peminjaman</button>
                        </div>
                    </form>
                    
                    <div class="mt-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Data Peminjaman</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto border-collapse">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="px-4 py-3 text-left border">Nama Peminjam</th>
                                        <th class="px-4 py-3 text-left border">Tanggal</th>
                                        <th class="px-4 py-3 text-left border">Barang</th>
                                        <th class="px-4 py-3 text-left border">Kode</th>
                                        <th class="px-4 py-3 text-left border">Jumlah</th>
                                        <th class="px-4 py-3 text-left border">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="peminjamanTable">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pengembalian -->
            <div id="pengembalian" class="page-content hidden">
                <div class="card rounded-xl p-8 shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Pengembalian Barang</h2>
                    <form id="pengembalianForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Nama Pengembalian</label>
                            <input type="text" id="namaPengembalian" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Tanggal Pengembalian</label>
                            <input type="date" id="tanggalPengembalian" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 font-medium mb-2">Pilih Barang yang Dipinjam</label>
                            <select id="pilihBarangKembali" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                                <option value="">Pilih Barang</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="btn-primary text-white px-8 py-3 rounded-lg font-semibold">Proses Pengembalian</button>
                        </div>
                    </form>
                    
                    <div class="mt-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Data Pengembalian</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto border-collapse">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="px-4 py-3 text-left border">Nama</th>
                                        <th class="px-4 py-3 text-left border">Tanggal</th>
                                        <th class="px-4 py-3 text-left border">Barang</th>
                                        <th class="px-4 py-3 text-left border">Kode</th>
                                        <th class="px-4 py-3 text-left border">Jumlah</th>
                                    </tr>
                                </thead>
                                <tbody id="pengembalianTable">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Laporan -->
            <div id="laporan" class="page-content hidden">
                <div class="card rounded-xl p-8 shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Cetak Laporan</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="text-center p-6 border rounded-lg">
                            <h3 class="text-lg font-semibold mb-4">Laporan Data Barang</h3>
                            <button id="cetakPDFBarang" class="btn-primary text-white px-6 py-3 rounded-lg mb-2 w-full">üìÑ Cetak PDF</button>
                            <button id="cetakExcelBarang" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg w-full">üìä Cetak Excel</button>
                        </div>
                        <div class="text-center p-6 border rounded-lg">
                            <h3 class="text-lg font-semibold mb-4">Laporan Peminjaman</h3>
                            <button id="cetakPDFPeminjaman" class="btn-primary text-white px-6 py-3 rounded-lg mb-2 w-full">üìÑ Cetak PDF</button>
                            <button id="cetakExcelPeminjaman" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg w-full">üìä Cetak Excel</button>
                        </div>
                        <div class="text-center p-6 border rounded-lg">
                            <h3 class="text-lg font-semibold mb-4">Laporan Barang Rusak</h3>
                            <button id="cetakPDFRusak" class="btn-primary text-white px-6 py-3 rounded-lg mb-2 w-full">üìÑ Cetak PDF</button>
                            <button id="cetakExcelRusak" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg w-full">üìä Cetak Excel</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hapus Barang -->
            <div id="hapus-barang" class="page-content hidden">
                <div class="card rounded-xl p-8 shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Hapus Barang</h2>
                    <form id="hapusBarangForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Pilih Barang</label>
                            <select id="pilihBarangHapus" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                                <option value="">Pilih Barang</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Alasan Penghapusan</label>
                            <select id="alasanHapus" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                                <option value="">Pilih Alasan</option>
                                <option value="Rusak Total">Rusak Total</option>
                                <option value="Hilang">Hilang</option>
                                <option value="Tidak Layak Pakai">Tidak Layak Pakai</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-lg font-semibold">Hapus Barang</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Barang Rusak -->
            <div id="barang-rusak" class="page-content hidden">
                <div class="card rounded-xl p-8 shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Barang Rusak</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="px-4 py-3 text-left border">Kode</th>
                                    <th class="px-4 py-3 text-left border">Nama Barang</th>
                                    <th class="px-4 py-3 text-left border">Seri</th>
                                    <th class="px-4 py-3 text-left border">Jumlah</th>
                                    <th class="px-4 py-3 text-left border">Keterangan</th>
                                    <th class="px-4 py-3 text-left border">Tanggal</th>
                                </tr>
                            </thead>
                            <tbody id="barangRusakTable">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Edit Barang -->
            <div id="edit-barang" class="page-content hidden">
                <div class="card rounded-xl p-8 shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Edit Barang</h2>
                    <form id="editBarangForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Pilih Barang</label>
                            <select id="pilihBarangEdit" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                                <option value="">Pilih Barang</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Nama Barang Baru</label>
                            <input type="text" id="namaBarangEdit" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Kode Barang Baru</label>
                            <input type="text" id="kodeBarangEdit" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Seri Barang Baru</label>
                            <input type="text" id="seriBarangEdit" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Kondisi Barang</label>
                            <select id="kondisiBarangEdit" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                                <option value="">Pilih Kondisi</option>
                                <option value="Baik">Baik</option>
                                <option value="Cukup">Cukup</option>
                                <option value="Rusak">Rusak</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Jumlah Barang</label>
                            <input type="number" id="jumlahBarangEdit" min="1" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white px-8 py-3 rounded-lg font-semibold">Update Barang</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Data Storage
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let barangData = JSON.parse(localStorage.getItem('barangData')) || [];
        let peminjamanData = JSON.parse(localStorage.getItem('peminjamanData')) || [];
        let pengembalianData = JSON.parse(localStorage.getItem('pengembalianData')) || [];
        let barangRusakData = JSON.parse(localStorage.getItem('barangRusakData')) || [];
        let currentUser = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalPeminjaman').value = today;
            document.getElementById('tanggalPengembalian').value = today;
            
            updateDashboard();
            updateAllSelects();
            updateAllTables();
        });

        // Authentication
        document.getElementById('showRegister').addEventListener('click', function() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('registerPage').classList.remove('hidden');
        });

        document.getElementById('showLogin').addEventListener('click', function() {
            document.getElementById('registerPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
        });

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            if (password !== confirmPassword) {
                alert('Password tidak cocok!');
                return;
            }

            if (users.find(user => user.username === username)) {
                alert('Username sudah digunakan!');
                return;
            }

            users.push({ name, username, password });
            localStorage.setItem('users', JSON.stringify(users));
            alert('Registrasi berhasil! Silakan login.');
            
            document.getElementById('registerPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('registerForm').reset();
        });

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                document.getElementById('currentUser').textContent = user.name;
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                updateDashboard();
            } else {
                alert('Username atau password salah!');
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', function() {
            currentUser = null;
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('loginForm').reset();
        });

        // Navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const page = this.dataset.page;
                
                // Hide all pages
                document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
                
                // Show selected page
                document.getElementById(page).classList.remove('hidden');
                document.getElementById(page).classList.add('fade-in');
                
                // Update nav buttons
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Update data when switching pages
                updateAllSelects();
                updateAllTables();
            });
        });

        // Input Barang
        document.getElementById('inputBarangForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const barang = {
                id: Date.now(),
                nama: document.getElementById('namaBarang').value,
                kode: document.getElementById('kodeBarang').value,
                seri: document.getElementById('seriBarang').value,
                kondisi: document.getElementById('kondisiBarang').value,
                jumlah: parseInt(document.getElementById('jumlahBarang').value),
                jumlahAwal: parseInt(document.getElementById('jumlahBarang').value),
                status: 'Tersedia'
            };

            // Check if kode already exists
            if (barangData.find(b => b.kode === barang.kode)) {
                alert('Kode barang sudah ada!');
                return;
            }

            barangData.push(barang);
            localStorage.setItem('barangData', JSON.stringify(barangData));
            
            alert('Barang berhasil ditambahkan!');
            this.reset();
            updateDashboard();
            updateAllSelects();
            updateAllTables();
        });

        // Peminjaman
        document.getElementById('peminjamanForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const kodeBarang = document.getElementById('pilihBarangPinjam').value;
            const jumlahPinjam = parseInt(document.getElementById('jumlahPeminjaman').value);
            
            const barang = barangData.find(b => b.kode === kodeBarang);
            
            if (!barang) {
                alert('Barang tidak ditemukan!');
                return;
            }
            
            if (barang.jumlah < jumlahPinjam) {
                alert('Stok tidak mencukupi! Tersedia: ' + barang.jumlah);
                return;
            }

            const peminjaman = {
                id: Date.now(),
                nama: document.getElementById('namaPeminjam').value,
                tanggal: document.getElementById('tanggalPeminjaman').value,
                kodeBarang: kodeBarang,
                namaBarang: barang.nama,
                jumlah: jumlahPinjam,
                status: 'Dipinjam'
            };

            // Update stok barang
            barang.jumlah -= jumlahPinjam;
            
            peminjamanData.push(peminjaman);
            localStorage.setItem('barangData', JSON.stringify(barangData));
            localStorage.setItem('peminjamanData', JSON.stringify(peminjamanData));
            
            alert('Peminjaman berhasil diproses!');
            this.reset();
            updateDashboard();
            updateAllSelects();
            updateAllTables();
        });

        // Pengembalian
        document.getElementById('pengembalianForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const peminjamanId = document.getElementById('pilihBarangKembali').value;
            const peminjaman = peminjamanData.find(p => p.id == peminjamanId);
            
            if (!peminjaman) {
                alert('Data peminjaman tidak ditemukan!');
                return;
            }

            const pengembalian = {
                id: Date.now(),
                nama: document.getElementById('namaPengembalian').value,
                tanggal: document.getElementById('tanggalPengembalian').value,
                kodeBarang: peminjaman.kodeBarang,
                namaBarang: peminjaman.namaBarang,
                jumlah: peminjaman.jumlah
            };

            // Update stok barang
            const barang = barangData.find(b => b.kode === peminjaman.kodeBarang);
            if (barang) {
                barang.jumlah += peminjaman.jumlah;
            }

            // Remove from peminjaman
            peminjamanData = peminjamanData.filter(p => p.id != peminjamanId);
            
            pengembalianData.push(pengembalian);
            localStorage.setItem('barangData', JSON.stringify(barangData));
            localStorage.setItem('peminjamanData', JSON.stringify(peminjamanData));
            localStorage.setItem('pengembalianData', JSON.stringify(pengembalianData));
            
            alert('Pengembalian berhasil diproses!');
            this.reset();
            updateDashboard();
            updateAllSelects();
            updateAllTables();
        });

        // Hapus Barang
        document.getElementById('hapusBarangForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const kodeBarang = document.getElementById('pilihBarangHapus').value;
            const alasan = document.getElementById('alasanHapus').value;
            const barang = barangData.find(b => b.kode === kodeBarang);
            
            if (!barang) {
                alert('Barang tidak ditemukan!');
                return;
            }

            if (confirm('Yakin ingin menghapus barang ini?')) {
                // Pindah ke barang rusak
                const barangRusak = {
                    id: Date.now(),
                    kode: barang.kode,
                    nama: barang.nama,
                    seri: barang.seri,
                    jumlah: barang.jumlah,
                    keterangan: alasan,
                    tanggal: new Date().toISOString().split('T')[0]
                };
                
                barangRusakData.push(barangRusak);
                
                // Hapus dari database barang
                barangData = barangData.filter(b => b.kode !== kodeBarang);
                
                localStorage.setItem('barangData', JSON.stringify(barangData));
                localStorage.setItem('barangRusakData', JSON.stringify(barangRusakData));
                
                alert('Barang berhasil dihapus dan dipindah ke barang rusak!');
                this.reset();
                updateDashboard();
                updateAllSelects();
                updateAllTables();
            }
        });

        // Edit Barang
        document.getElementById('pilihBarangEdit').addEventListener('change', function() {
            const kodeBarang = this.value;
            const barang = barangData.find(b => b.kode === kodeBarang);
            
            if (barang) {
                document.getElementById('namaBarangEdit').value = barang.nama;
                document.getElementById('kodeBarangEdit').value = barang.kode;
                document.getElementById('seriBarangEdit').value = barang.seri;
                document.getElementById('kondisiBarangEdit').value = barang.kondisi;
                document.getElementById('jumlahBarangEdit').value = barang.jumlah;
            }
        });

        document.getElementById('editBarangForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const kodeBarangLama = document.getElementById('pilihBarangEdit').value;
            const barang = barangData.find(b => b.kode === kodeBarangLama);
            
            if (!barang) {
                alert('Barang tidak ditemukan!');
                return;
            }

            // Update data barang
            barang.nama = document.getElementById('namaBarangEdit').value;
            barang.kode = document.getElementById('kodeBarangEdit').value;
            barang.seri = document.getElementById('seriBarangEdit').value;
            barang.kondisi = document.getElementById('kondisiBarangEdit').value;
            barang.jumlah = parseInt(document.getElementById('jumlahBarangEdit').value);
            
            localStorage.setItem('barangData', JSON.stringify(barangData));
            
            alert('Data barang berhasil diupdate!');
            this.reset();
            updateDashboard();
            updateAllSelects();
            updateAllTables();
        });

        // Update Functions
        function updateDashboard() {
            const totalBarang = barangData.reduce((sum, b) => sum + b.jumlah, 0);
            const totalDipinjam = peminjamanData.reduce((sum, p) => sum + p.jumlah, 0);
            const totalRusak = barangRusakData.reduce((sum, r) => sum + r.jumlah, 0);
            const totalTersedia = totalBarang - totalDipinjam;

            document.getElementById('totalBarang').textContent = totalBarang;
            document.getElementById('totalDipinjam').textContent = totalDipinjam;
            document.getElementById('totalRusak').textContent = totalRusak;
            document.getElementById('totalTersedia').textContent = totalTersedia;
        }

        function updateAllSelects() {
            // Update select options for available items
            const availableItems = barangData.filter(b => b.jumlah > 0);
            
            updateSelect('pilihBarangPinjam', availableItems);
            updateSelect('pilihBarangHapus', barangData);
            updateSelect('pilihBarangEdit', barangData);
            
            // Update pengembalian select with borrowed items
            const borrowedItems = peminjamanData.map(p => ({
                value: p.id,
                text: `${p.namaBarang} (${p.nama} - ${p.tanggal})`
            }));
            
            const selectKembali = document.getElementById('pilihBarangKembali');
            selectKembali.innerHTML = '<option value="">Pilih Barang</option>';
            borrowedItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item.value;
                option.textContent = item.text;
                selectKembali.appendChild(option);
            });
        }

        function updateSelect(selectId, items) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Pilih Barang</option>';
            
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item.kode;
                option.textContent = `${item.nama} (${item.kode}) - Stok: ${item.jumlah}`;
                select.appendChild(option);
            });
        }

        function updateAllTables() {
            updateDatabaseBarangTable();
            updatePeminjamanTable();
            updatePengembalianTable();
            updateBarangRusakTable();
        }

        function updateDatabaseBarangTable() {
            const tbody = document.getElementById('databaseBarangTable');
            tbody.innerHTML = '';
            
            barangData.forEach(barang => {
                const row = document.createElement('tr');
                row.className = 'border hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3 border">${barang.kode}</td>
                    <td class="px-4 py-3 border">${barang.nama}</td>
                    <td class="px-4 py-3 border">${barang.seri}</td>
                    <td class="px-4 py-3 border">
                        <span class="px-2 py-1 rounded text-sm ${barang.kondisi === 'Baik' ? 'bg-green-100 text-green-800' : 
                            barang.kondisi === 'Cukup' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                            ${barang.kondisi}
                        </span>
                    </td>
                    <td class="px-4 py-3 border">${barang.jumlah}</td>
                    <td class="px-4 py-3 border">
                        <span class="px-2 py-1 rounded text-sm ${barang.jumlah > 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${barang.jumlah > 0 ? 'Tersedia' : 'Habis'}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updatePeminjamanTable() {
            const tbody = document.getElementById('peminjamanTable');
            tbody.innerHTML = '';
            
            peminjamanData.forEach(peminjaman => {
                const row = document.createElement('tr');
                row.className = 'border hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3 border">${peminjaman.nama}</td>
                    <td class="px-4 py-3 border">${peminjaman.tanggal}</td>
                    <td class="px-4 py-3 border">${peminjaman.namaBarang}</td>
                    <td class="px-4 py-3 border">${peminjaman.kodeBarang}</td>
                    <td class="px-4 py-3 border">${peminjaman.jumlah}</td>
                    <td class="px-4 py-3 border">
                        <span class="px-2 py-1 rounded text-sm bg-orange-100 text-orange-800">
                            ${peminjaman.status}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updatePengembalianTable() {
            const tbody = document.getElementById('pengembalianTable');
            tbody.innerHTML = '';
            
            pengembalianData.forEach(pengembalian => {
                const row = document.createElement('tr');
                row.className = 'border hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3 border">${pengembalian.nama}</td>
                    <td class="px-4 py-3 border">${pengembalian.tanggal}</td>
                    <td class="px-4 py-3 border">${pengembalian.namaBarang}</td>
                    <td class="px-4 py-3 border">${pengembalian.kodeBarang}</td>
                    <td class="px-4 py-3 border">${pengembalian.jumlah}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateBarangRusakTable() {
            const tbody = document.getElementById('barangRusakTable');
            tbody.innerHTML = '';
            
            barangRusakData.forEach(barang => {
                const row = document.createElement('tr');
                row.className = 'border hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3 border">${barang.kode}</td>
                    <td class="px-4 py-3 border">${barang.nama}</td>
                    <td class="px-4 py-3 border">${barang.seri}</td>
                    <td class="px-4 py-3 border">${barang.jumlah}</td>
                    <td class="px-4 py-3 border">${barang.keterangan}</td>
                    <td class="px-4 py-3 border">${barang.tanggal}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Print Functions
        document.getElementById('cetakPDFBarang').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text('LAPORAN DATA BARANG', 20, 20);
            doc.text('LABORATORIUM TJKT SMKN 1 LIWA', 20, 30);
            
            let y = 50;
            doc.setFontSize(12);
            doc.text('Kode', 20, y);
            doc.text('Nama Barang', 50, y);
            doc.text('Seri', 100, y);
            doc.text('Kondisi', 130, y);
            doc.text('Jumlah', 160, y);
            
            y += 10;
            barangData.forEach(barang => {
                doc.text(barang.kode, 20, y);
                doc.text(barang.nama, 50, y);
                doc.text(barang.seri, 100, y);
                doc.text(barang.kondisi, 130, y);
                doc.text(barang.jumlah.toString(), 160, y);
                y += 10;
            });
            
            // Add signature section
            y += 20;
            const currentDate = new Date().toLocaleDateString('id-ID');
            doc.text(`Liwa, ${currentDate}`, 130, y);
            y += 10;
            doc.text('Kepala Jurusan TJKT', 130, y);
            y += 30;
            doc.text('_____________________', 130, y);
            y += 10;
            doc.text('NIP. _______________', 130, y);
            
            doc.save('laporan-data-barang.pdf');
        });

        document.getElementById('cetakExcelBarang').addEventListener('click', function() {
            const ws = XLSX.utils.json_to_sheet(barangData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data Barang');
            XLSX.writeFile(wb, 'laporan-data-barang.xlsx');
        });

        document.getElementById('cetakPDFPeminjaman').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text('LAPORAN PEMINJAMAN BARANG', 20, 20);
            doc.text('LABORATORIUM TJKT SMKN 1 LIWA', 20, 30);
            
            let y = 50;
            doc.setFontSize(12);
            doc.text('Nama', 20, y);
            doc.text('Tanggal', 60, y);
            doc.text('Barang', 100, y);
            doc.text('Jumlah', 160, y);
            
            y += 10;
            peminjamanData.forEach(peminjaman => {
                doc.text(peminjaman.nama, 20, y);
                doc.text(peminjaman.tanggal, 60, y);
                doc.text(peminjaman.namaBarang, 100, y);
                doc.text(peminjaman.jumlah.toString(), 160, y);
                y += 10;
            });
            
            // Add signature section
            y += 20;
            const currentDate = new Date().toLocaleDateString('id-ID');
            doc.text(`Liwa, ${currentDate}`, 130, y);
            y += 10;
            doc.text('Kepala Jurusan TJKT', 130, y);
            y += 30;
            doc.text('_____________________', 130, y);
            y += 10;
            doc.text('NIP. _______________', 130, y);
            
            doc.save('laporan-peminjaman.pdf');
        });

        document.getElementById('cetakExcelPeminjaman').addEventListener('click', function() {
            const ws = XLSX.utils.json_to_sheet(peminjamanData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data Peminjaman');
            XLSX.writeFile(wb, 'laporan-peminjaman.xlsx');
        });

        document.getElementById('cetakPDFRusak').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text('LAPORAN BARANG RUSAK', 20, 20);
            doc.text('LABORATORIUM TJKT SMKN 1 LIWA', 20, 30);
            
            let y = 50;
            doc.setFontSize(12);
            doc.text('Kode', 20, y);
            doc.text('Nama Barang', 50, y);
            doc.text('Jumlah', 100, y);
            doc.text('Keterangan', 130, y);
            
            y += 10;
            barangRusakData.forEach(barang => {
                doc.text(barang.kode, 20, y);
                doc.text(barang.nama, 50, y);
                doc.text(barang.jumlah.toString(), 100, y);
                doc.text(barang.keterangan, 130, y);
                y += 10;
            });
            
            // Add signature section
            y += 20;
            const currentDate = new Date().toLocaleDateString('id-ID');
            doc.text(`Liwa, ${currentDate}`, 130, y);
            y += 10;
            doc.text('Kepala Jurusan TJKT', 130, y);
            y += 30;
            doc.text('_____________________', 130, y);
            y += 10;
            doc.text('NIP. _______________', 130, y);
            
            doc.save('laporan-barang-rusak.pdf');
        });

        document.getElementById('cetakExcelRusak').addEventListener('click', function() {
            const ws = XLSX.utils.json_to_sheet(barangRusakData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Barang Rusak');
            XLSX.writeFile(wb, 'laporan-barang-rusak.xlsx');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98715e1002b5aa34',t:'MTc1OTIxMDYzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
